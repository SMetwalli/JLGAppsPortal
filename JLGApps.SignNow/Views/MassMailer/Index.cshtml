@model JLGApps.SignNow.ViewModels.FileLoaderViewModel
@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en" >
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no">
    <title>JLG - JLG App Portal </title>
    <link rel="icon" type="image/x-icon" href="~/assets/img/favicon.ico" />
    <link href="~/assets/css/loader.css" rel="stylesheet" type="text/css" />



    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">
    <link href="~/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/plugins.css" rel="stylesheet" type="text/css" />

    <!-- END GLOBAL MANDATORY STYLES -->
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM STYLES -->
    <!--  BEGIN CUSTOM STYLE FILE  -->



    <link rel="stylesheet" type="text/css" href="~/plugins/table/datatable/datatables.css">
    <link rel="stylesheet" type="text/css" href="~/assets/css/forms/theme-checkbox-radio.css">
    <link rel="stylesheet" type="text/css" href="~/plugins/table/datatable/dt-global_style.css">
    <link rel="stylesheet" type="text/css" href="~/plugins//table/datatable/custom_dt_custom.css">
    <link rel="stylesheet" type="text/css" href="~/plugins/bootstrap-select/bootstrap-select.min.css">
    <link href="~/summernote-0.8.18-dist/summernote-lite.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    <link href="~/plugins/animate/animate.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/scrollspyNav.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/components/custom-modal.css" rel="stylesheet" type="text/css" />
    <link href="~/plugins/loaders/custom-loader.css" rel="stylesheet" type="text/css" />
    <link href="~/assets/css/tables/table-basic.css" rel="stylesheet" type="text/css" />

    <!--  END CUSTOM STYLE FILE  -->
    <!-- END PAGE LEVEL PLUGINS/CUSTOM STYLES -->

</head>
<body data-spy="scroll" data-target="#navSection" data-offset="100">
    <!-- BEGIN LOADER -->
    <div id="load_screen">
        <div class="loader">
            <div class="loader-content">
                <div class="spinner-grow align-self-center"></div>
            </div>
        </div>
    </div>
    <!--  END LOADER -->
    <!--  BEGIN NAVBAR  -->
    <div class="header-container fixed-top">
        <header class="header navbar navbar-expand-sm">

            <ul class="navbar-item theme-brand flex-row  text-center">
                <li class="nav-item theme-logo">
                    <a href="index.html">
                        <img src="~/assets/img/90x90.jpg" class="navbar-logo" alt="logo">
                    </a>
                </li>
                <li class="nav-item theme-text">
                    <a href="#" class="nav-link"> Johnson Law Group </a>
                </li>
            </ul>

            <ul class="navbar-item flex-row ml-md-auto">

                <li class="nav-item dropdown user-profile-dropdown">
                    <a href="javascript:void(0);" class="nav-link dropdown-toggle user" id="userProfileDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <img src="~/assets/img/90x90.jpg" alt="avatar">
                    </a>
                    <div class="dropdown-menu position-absolute" aria-labelledby="userProfileDropdown">
                        <div class="">
                            <div class="dropdown-item">
                                <a class="" href="user_profile.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-user"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg> My Profile</a>
                            </div>
                            <div class="dropdown-item">
                                <a class="" href="apps_mailbox.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-inbox"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"></polyline><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"></path></svg> Inbox</a>
                            </div>
                            <div class="dropdown-item">
                                <a class="" href="auth_lockscreen.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lock"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg> Lock Screen</a>
                            </div>
                            <div class="dropdown-item">
                                <a class="" href="auth_login.html"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-log-out"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg> Sign Out</a>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </header>
    </div>
    <!--  END NAVBAR  -->
    <!--  BEGIN NAVBAR  -->
    <div class="sub-header-container">
        <header class="header navbar navbar-expand-sm">
            <a href="javascript:void(0);" class="sidebarCollapse" data-placement="bottom"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></a>

            <ul class="navbar-nav flex-row">
                <li>
                    <div class="page-header">
                        <div class="page-title">
                            <h3>Tools</h3>
                        </div>
                    </div>
                </li>
            </ul>
        </header>
    </div>
    <!--  END NAVBAR  -->
    <!--  BEGIN MAIN CONTAINER  -->
    <div class="main-container" id="container">

        <div class="overlay"></div>
        <div class="search-overlay"></div>

        <!--  BEGIN SIDEBAR  -->
        <div class="sidebar-wrapper sidebar-theme">
            <nav id="sidebar">
                <div class="shadow-bottom"></div>
                <ul class="list-unstyled menu-categories" id="accordionExample">
                    <li class="menu">
                        <a href="javascript:void(0);" aria-expanded="false" class="dropdown-toggle">
                            <div class="">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                                <span>Dashboard</span>
                            </div>
                        </a>
                    </li>
                    <li class="menu">
                        <a href="#submenu" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                            <div class="">

                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline></svg>
                                <span> Document Sign </span>
                            </div>
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
                            </div>
                        </a>
                        <ul class="collapse submenu list-unstyled" id="submenu" data-parent="#accordionExample">
                            <li>
                                <a href="~/MassMailer/Index">Send Document Link</a>
                            </li>
                            <li>
                                <a href="~/Logs/Index">Email Logs</a>
                            </li>
                        </ul>
                    </li>

                    <li class="menu">
                        <a href="#submenu2" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle">
                            <div class="">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-airplay"><path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path><polygon points="12 15 17 21 7 21 12 15"></polygon></svg>
                                <span>Batch Import</span>
                            </div>
                            <div>
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg>
                            </div>
                        </a>
                        <ul class="collapse submenu list-unstyled" id="submenu2" data-parent="#accordionExample">
                            <li>
                                <a href="javascript:void(0);"> Update Data</a>
                            </li>
                            <li>
                                <a href="#sm2" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"> Submenu 2 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg> </a>
                                <ul class="collapse list-unstyled sub-submenu" id="sm2" data-parent="#submenu2">
                                    <li>
                                        <a href="javascript:void(0);"> Litigation </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Checklist </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Record Request </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Cases </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Management </a>
                                    </li>
                                </ul>
                            </li>
                            <li>
                                <a href="javascript:void(0);"> Insert Data</a>
                            </li>
                            <li>
                                <a href="#sm2" data-toggle="collapse" aria-expanded="false" class="dropdown-toggle"> Submenu 2 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg> </a>
                                <ul class="collapse list-unstyled sub-submenu" id="sm2" data-parent="#submenu2">
                                    <li>
                                        <a href="javascript:void(0);"> Litigation </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Checklist </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Notes </a>
                                    </li>
                                    <li>
                                        <a href="javascript:void(0);"> Client Contact </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>
        <!--  END SIDEBAR  -->
        <!--  BEGIN CONTENT PART  -->
        <div id="content" class="main-content">
            <div class="layout-px-spacing">
                <div class="container">
                    <div id="navSection" data-spy="affix" class="nav  sidenav">
                        <div class="sidenav-content">
                            <a href="#RecipientList" class="active nav-link">Recipient Excel List</a>
                            <a href="#documentCreate" class="nav-link">Create Signer Link</a>
                            <a href="#Emailer" class="nav-link">Emailer</a>
                            <a href="#SMS" class="nav-link">Text Messenger</a>
                        </div>
                    </div>
                    <div class="container">
                        <div class="row layout-spacing">
                            <div id="RecipientList" class="col-lg-12">
                                <div class="statbox widget box box-shadow">
                                    <div class="widget-header">
                                        <div class="row">
                                            <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                <h3>Recipient List</h3>
                                            </div>
                                        </div>

                                        <form method="post" asp-action="LoadData" asp-controller="MassMailer" enctype="multipart/form-data">
                                            <div class="row">
                                                <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                    <div class="form-group mb-4 mt-3">
                                                        <label for="xlsxFile">Excel File Upload (.xlsx)</label>

                                                        <div class="custom-file">
                                                            <input type="file" id="btnUploadedFile" class="custom-file-input" name="xslxFile" accept=".xlsx">
                                                            <label id="fileName" class="custom-file-label" for="btnUploadedFile">Choose a excel file</label>
                                                            <input id="btnExcelFileUpload" type="submit" value="Import Excel Sheet" class="mt-4 mb-4 btn btn-primary">
                                                        </div>
                                                        @{
                                                            @if (Model != null)
                                                            {
                                                                @if (Model.FileAndPath != null)
                                                                {
                                                                    <label id="fileAndPath">@Model.FileAndPath</label>
                                                                }
                                                            }
                                                        }
                                                        <textarea id="@Html.IdFor(p => p.EmailBody)" name="@Html.IdFor(p => p.EmailBody)" hidden class="emailBodyTextVerbage"></textarea>
                                                        <input type="hidden" name="emailBody" id="upload_EmailBodyText" />
                                                        <input type="hidden" name="emailSubject" id="upload_EmailSubject" />
                                                        <input type="hidden" name="emailSender" id="upload_EmailSender" />
                                                        <input type="hidden" name="emailRecipient" id="upload_EmailRecipient" />
                                                        <input type="hidden" name="txtMessage" id="upload_SMSBody" />
                                                        <input type="hidden" name="txtRecipient" id="upload_SMSRecipient" />
                                                        <input type="hidden" name="folderId" id="upload_TemplateFolderId" />
                                                        <input type="hidden" name="selectedFolder" id="upload_TemplateFolder" />
                                                        <input type="hidden" name="casenumberExcelHeader" id="upload_FolderCasenumber" />
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <div class="widget-content widget-content-area">
                                            <div class="table-responsive mb-4 style-1">
                                                <table id="style-1" class="table style-1 table-hover non-hover">
                                                    @{
                                                        <partial name="_RecipientsPartial" />
                                                    }
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div id="documentCreate" class="col-lg-12">
                            <div class="statbox widget box box-shadow">
                                <div class="widget-header">
                                    <div class="row">
                                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                            <div style="padding:10px"> <h3>Document Create</h3></div>
                                        </div>
                                    </div>
                                </div>

                                <div class="widget-content widget-content-area">
                                    <form method="post" asp-action="SelectedTemplateFolder" asp-controller="MassMailer">
                                        <div class="table-responsive">
                                            <table class="table mb-4 contextual-table">
                                                <thead>
                                                    <tr>
                                                        <th>Template Folder</th>

                                                        <th>Case Number</th>
                                                        <th></th>

                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <tr class="table-default">
                                                        <td>
                                                            <select size="1" id="selectedTemplateFolder" class="form-control" style="width:250px">
                                                                <!option>NONE</!option>
                                                                @if (Model.TemplateFolderList != null)
                                                                {
                                                                    @foreach (var folder in Model.TemplateFolderList.folders.Where(cat => cat.name == "Team Templates"))
                                                                    {
                                                                        string selectedFolder = "";


                                                                        if (Model.SelectedTemplateFolder == folder.team_name)
                                                                        {
                                                                            selectedFolder = "Selected";

                                                                        }

                                                                        <!option @selectedFolder value="@folder.id">
                                                                            @folder.team_name
                                                                        </!option>
                                                                    }
                                                                }

                                                            </select>
                                                        </td>

                                                        <td>
                                                            <select size="1" id="casenumMergeHeader" class="form-control" name="casenumberExcelHeader" style="width:250px;">
                                                                <option>NONE</option>
                                                                @if (Model.Recipients != null)
                                                                {


                                                                    var excelHeader = Model.Recipients.FirstOrDefault();


                                                                    foreach (var column in excelHeader.Columns)
                                                                    {
                                                                        string selectedFolder = "";
                                                                        if (column.Column == Model.CaseNumberExcelHeader)
                                                                        {
                                                                            selectedFolder = "Selected";

                                                                        }
                                                                        <!option @selectedFolder>
                                                                            @column.Column
                                                                        </!option>
                                                                    }


                                                                }
                                                            </select>
                                                        </td>

                                                        <td>
                                                            <input id="loadTemplates" type="submit" value="Load Templates" class="btn btn-primary" style="float:left">
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <textarea id="@Html.IdFor(p => p.EmailBody)" name="@Html.IdFor(p => p.EmailBody)" hidden class="emailBodyTextVerbage"></textarea>
                                            <input type="hidden" name="emailBody" id="templateSelect_EmailBody" />
                                            <input type="hidden" name="emailRecipientAddress" id="templateSelect_EmailRecipient" />
                                            <input type="hidden" name="emailSubject" id="templateSelect_EmailSubject" />
                                            <input type="hidden" name="emailSender" id="templateSelect_EmailFrom" />
                                            <input type="hidden" name="xslxFile" id="templateSelect_ExcelFile" />
                                            <input type="hidden" name="folderId" id="templateSelect_TemplateFolderId" />
                                            <input type="hidden" name="selectedFolder" id="templateSelect_TemplateFolder" />
                                            <input type="hidden" name="casenumberExcelHeader" id="templateSelect_FolderCasenumber" />
                                            <input type="hidden" name="txtMessage" id="templateSelect_SMS" />
                                            <input type="hidden" name="txtRecipient" id="templateSelect_RecipientSMS" />
                                        </div>

                                     
                                    </form>
                                    <br />
                                    <div class="table-responsive mb-4 style-1">

                                        <table id="template-dtListing" class="table style-1 table-hover non-hover">
                                            <thead>
                                                <tr>
                                                    <th class="checkbox-column" style="display:none;"> Template ID </th>
                                                    <th>Template Name</th>
                                                    <th>Template Folder</th>
                                                    <th style="text-align: center;">Action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @if (Model.MultipleTemplateProfiles != null)
                                                {
                                                    @foreach (var templateName in Model.MultipleTemplateProfiles)
                                                    {
                                                        <tr>
                                                            <td class="checkbox-column" style="display:none;">@templateName.templateFolderID</td>

                                                            <td class="user-name">
                                                                @templateName.Name
                                                            </td>
                                                            <td>
                                                                @templateName.folderName
                                                            </td>

                                                            <td class="text-center"> <button id="btnCreateDocument" class="btn btn-primary">Create Document</button> </td>
                                                        </tr>
                                                    }
                                                }
                                            </tbody>
                                        </table>                                       
                                        
                                        <textarea id="@Html.IdFor(p => p.EmailBody)" name="@Html.IdFor(p => p.EmailBody)" hidden class="emailBodyTextVerbage"></textarea>
                                        <input type="hidden" name="emailBody" id="documentCreate_EmailBody" />
                                        <input type="hidden" name="emailSubject" id="documentCreate_EmailSubject" />
                                        <input type="hidden" name="emailSender" id="documentCreate_EmailSender" />
                                        <input type="hidden" name="emailRecipient" id="documentCreate_EmailRecipient" />
                                        <input type="hidden" name="txtMessage" id="documentCreate_SMSBody" />
                                        <input type="hidden" name="txtRecipient" id="documentCreate_SMSRecipient" />
                                        <input type="hidden" name="folderId" id="documentCreate_TemplateFolderId" />
                                        <input type="hidden" name="selectedFolder" id="documentCreate_TemplateFolder" />
                                        <input type="hidden" name="casenumberExcelHeader" id="documentCreate_FolderCasenumber" />
                                        @if (Model.SingleTemplateProfile != null)
                                        {
                                            <label id="templateName" style="font-size:1.2em;">@Model.SingleTemplateProfile.Name</label>

                                        }

                                        <div class="progress br-30">
                                            <div id="progress" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">0%</div>
                                        </div>
                                    </div>
                            </div>
                        </div>

                       
                        <div id="Emailer" class="row layout-top-spacing">
                            <div class="col-xl-12 col-lg-12 col-sm-12  layout-spacing">
                                <div class="col-lg-12 col-12 layout-spacing">
                                    <div class="statbox widget box box-shadow">
                                        <div class="widget-header">
                                            <div class="row">
                                                <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                                    <div style="padding:10px;"><h3>Mass Emailer</h3></div>
                                                </div>
                                            </div>
                                        </div>
                                      
                                        <div class="widget-content widget-content-area">
                                            <div class="form-group mb-4">
                                                <div style="width:50%;margin-left:16%">

                                                    <div class="col-sm-12">
                                                        <label for="exampleFormControlInput2">Subject</label>

                                                        <input type="text" name="emailSubject" class="form-control" id="subject" value="@Model.EmailSubject" required>


                                                        <label for="exampleFormControlInput2">To Address</label>

                                                        <input type="text" name="emailRecipientAddress" class="form-control" id="recipientEmail" value="@Model.EmailRecipient" required>

                                                        <label for="exampleFormControlSelect1">From</label><br />

                                                        <select id="from" name="sender" class="selectpicker mb-4" data-width="fit">

                                                            @foreach (var mailbox in Model.MailBoxes)
                                                            {
                                                                string selectedFlag = "";
                                                                @if (mailbox.Mailbox == Model.EmailSender)
                                                                {
                                                                    selectedFlag = "Selected";
                                                                }
                                                                <!option @selectedFlag> @mailbox.Mailbox</!option>
                                                            }

                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="container-fluid">
                                                    <div>

                                                        <div class="row">
                                                            <div class="container">
                                                                <div class="row">
                                                                    <div class="col-lg-12 nopadding">

                                                                        <textarea id="@Html.IdFor(p => p.EmailBody)" name="@Html.IdFor(p => p.EmailBody)" hidden class="emailBodyTextVerbage"></textarea>
                                                                        <div class="form-control summernote">@Html.Raw(Model.EmailBody)</div>
                                                                        <input type="hidden" name="emailBody" id="sendEmail_EmailBody" />
                                                                       
                                                                    </div>
                                                                </div>
                                                                <div class="row">
                                                                    <div class="col-lg-12 nopadding">
                                                                        <textarea style="border:none;width:950px;resize:none;">
                                                                            @{
                                                                                if (Model.Recipients != null)
                                                                                {
                                                                                    var headerRow = Model.Recipients.Where(p => p.RowIndex == 1).FirstOrDefault();
                                                                                    foreach (var header in headerRow.Columns)
                                                                                    {

                                                                                        string field = string.Concat("[[", @header.Column.ToUpper(), "]]", " ");
                                                                                        @field
                                                                                    }
                                                                                }
                                                                            }
                                                                            </textarea>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div style="margin-left:2%">
                                                            <input type="submit" name="time" id="btnSendEmail" value="Send Email" class="mt-4 mb-4 btn btn-primary">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="progress br-30">
                                                <div id="emailProgress" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">0%</div>
                                            </div>
                                          
                                          
                                        </div>
                                     
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-12 col-sm-12 col-12 layout-spacing">
                            <div class="statbox widget box box-shadow">
                                <div class="widget-header">
                                    <div class="row">                                      
                                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                                            <div style="padding:10px;"><h3>SMS</h3></div>
                                        </div>
                                    </div>
                                </div>
                                <div id="SMS" class="widget-content widget-content-area">
                                    <div class="form-group mb-4">
                                        <label for="exampleFormControlTextarea1">Message Body</label>
                                        <textarea id="smsBody" class="form-control" form="emailer" name="txtMessage" rows="3">@Model.SMSBody</textarea>
                                    </div>
                                    <div class="input-group mb-4">
                                        <input id="smsRecipient" type="text" class="form-control" form="emailer" name="txtRecipient" value="@Model.SMSRecipient" placeholder="Recipient" aria-label="Recipient's username">

                                        <div class="input-group-append">
                                            <button id="btnSendSms" class="btn btn-primary" type="button">Send SMS</button>
                                        </div>

                                    </div>
                                    <div class="progress br-30">
                                        <div id="smsProgress" class="progress-bar bg-info" role="progressbar" style="width: 0%" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">0%</div>
                                    </div>
                                    <div>

                                        @{
                                            if (Model.Recipients != null)
                                            {
                                                var headerRow = Model.Recipients.Where(p => p.RowIndex == 1).FirstOrDefault();
                                                foreach (var header in headerRow.Columns)
                                                {
                                                    string field = string.Concat("[[", @header.Column.ToUpper(), "]]", " ");
                                                    @field
                                                }
                                            }
                                        }
                                    </div>
                                    <br />

                                </div>
                            </div>
                        </div>

                        <div class="footer-wrapper">
                            <div class="footer-section f-section-1">
                                <p class="">Copyright © 2020 <a target="_blank" href="https://johnsonlawgroup.com">Johnson Law Group</a>, All rights reserved.</p>
                            </div>
                        </div>
                    </div>
                    <div id="zoomupModal" class="modal animated zoomInUp custo-zoomInUp" role="dialog">
                        <div class="modal-dialog">
                            <!-- Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Notification</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-x"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p class="modal-text">@ViewBag.MessageAlert</p>
                                </div>
                                <div class="modal-footer md-button">
                                    <button class="btn" data-dismiss="modal"><i class="flaticon-cancel-12"></i>Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--  END CONTENT PART  -->
    </div>
</div>
    <!-- END MAIN CONTAINER -->
    <!-- BEGIN GLOBAL MANDATORY SCRIPTS -->
    <script src="~/angular/angular.min.js"></script>
    <script src="~/angular/app.js"></script>
    <script src="~/assets/js/libs/jquery-3.1.1.min.js"></script>
    <script src="~/bootstrap/js/popper.min.js"></script>
    <script src="~/bootstrap/js/bootstrap.min.js"></script>


    <script src="~/assets/js/loader.js"></script>

    <script>
        $(document).ready(function () {
            App.init();
        });
    </script>

    <script src="~/plugins/highlight/highlight.pack.js"></script>
    <script src="~/assets/js/custom.js"></script>
    <script src="~/assets/js/scrollspyNav.js"></script>

    <!-- END GLOBAL MANDATORY SCRIPTS -->
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->

    <script src="~/plugins/bootstrap-select/bootstrap-select.min.js"></script>
    <script src="~/summernote-0.8.18-dist/summernote-lite.js"></script>

    <script src="~/plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="~/assets/js/app.js"></script>

    <script src="~/plugins/table/datatable/datatables.js"></script>


    <script>
        // var e;
        c1 = $('#style-1').DataTable({

            headerCallback: function (e, a, t, n, s) {
                e.getElementsByTagName("th")[0].innerHTML = '<label class="new-control new-checkbox checkbox-outline-info m-auto">\n<input type="checkbox" class="new-control-input chk-parent select-customers-info" id="customer-all-info">\n<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>\n</label>'
            },
            columnDefs: [{
                targets: 0, width: "30px", className: "", orderable: !1, render: function (e, a, t, n) {
                    return '<label class="new-control new-checkbox checkbox-outline-info  m-auto">\n<input type="checkbox" class="new-control-input child-chk select-customers-info" id="customer-all-info">\n<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>\n</label>'
                }
            }],
            "oLanguage": {
                "oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
                "sInfo": "Showing page _PAGE_ of _PAGES_",
                "sSearch": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
                "sSearchPlaceholder": "Search...",
                "sLengthMenu": "Results :  _MENU_",
            },
            "lengthMenu": [5, 10, 20, 50, 100, '999999'],
            "pageLength": 20,

        });

        multiCheck(c1);

        // var e;
        c2 = $('#template-dt').DataTable({

            headerCallback: function (e, a, t, n, s) {
                e.getElementsByTagName("th")[0].innerHTML = '<label class="new-control new-checkbox checkbox-outline-info m-auto">\n<input type="checkbox" class="new-control-input chk-parent select-customers-info" id="customer-all-info">\n<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>\n</label>'
            },
            columnDefs: [{
                targets: 0, width: "30px", className: "", orderable: !1, render: function (e, a, t, n) {
                    return '<label class="new-control new-checkbox checkbox-outline-info  m-auto">\n<input type="checkbox" class="new-control-input child-chk select-customers-info" id="customer-all-info">\n<span class="new-control-indicator"></span><span style="visibility:hidden">c</span>\n</label>'
                }
            }],
            "oLanguage": {
                "oPaginate": { "sPrevious": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>', "sNext": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>' },
                "sInfo": "Showing page _PAGE_ of _PAGES_",
                "sSearch": '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>',
                "sSearchPlaceholder": "Search...",
                "sLengthMenu": "Results :  _MENU_",
            },
            "lengthMenu": [5, 10, 20, 50, 100],
            "pageLength": 5,

        });

        multiCheck(c2);


    </script>


    <script type="text/javascript">

        $(document).ready(function () {


            $('.summernote').on('summernote.init', function () {
                $('textarea.emailBodyTextVerbage').html($('.summernote').summernote("code"))
            }).on("summernote.blur", function () {
                $('textarea.emailBodyTextVerbage').html($('.summernote').summernote("code"))
            }).summernote({
                height: 500,
                spellCheck: true,
                toolbar: [['style', ['style']],
                    ['font', ['bold', 'underline', 'clear']],
                    ['fontname', ['fontname']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['table', ['table']],
                    ['insert', ['link', 'picture', 'video']],
                    ['view', [ 'codeview']]],
            });
         
           
          
            document.getElementById('btnExcelFileUpload').style.display = 'block';
          
            var message ='@(ViewBag.MessageExist)';
            if (message == 'False') {                            
                $("#zoomupModal").hide();
            } else if (message == 'True') {              
                $("#zoomupModal").show();

            }
        });
    </script>


    <script>
        $("#btnExcelFileUpload").click(function () {
            
            var editorContent = $('#summernote').summernote('code');
            document.getElementById('upload_EmailBodyText').value = editorContent;
            var subject = $('#subject').val();
            var sender = $('#from').val();
            var recipient = $('#recipientEmail').val();
            var smsBody = $('#smsBody').val();
            var smsRecipient = $('#smsRecipient').val();

            var templateFolder = document.getElementById("selectedTemplateFolder");
            var folderId = templateFolder.options[templateFolder.selectedIndex].value;
            var selectedTemplateFolder = templateFolder.options[templateFolder.selectedIndex].text;

            var casenum = document.getElementById("casenumMergeHeader");
            var caseNumber = casenum.options[casenum.selectedIndex].text;

            document.getElementById('upload_EmailSubject').value = subject;
            document.getElementById('upload_EmailSender').value = sender;
            document.getElementById('upload_EmailRecipient').value = recipient;
           
            document.getElementById('upload_SMSBody').value = smsBody;
            document.getElementById('upload_SMSRecipient').value = smsRecipient;

            document.getElementById('upload_TemplateFolderId').value = folderId;
            document.getElementById('upload_TemplateFolder').value = selectedTemplateFolder;
            document.getElementById('upload_FolderCasenumber').value = caseNumber;

            document.getElementById('btnExcelFileUpload').style.display = 'none';
        });

       


        $('#btnUploadedFile').click(function () {

            const fileBtn = document.getElementById('btnUploadedFile');
            const fileLbl = document.getElementById('fileName');

            fileBtn.addEventListener("change", function () {
                if (fileBtn.value) {
                    fileLbl.innerHTML = fileBtn.value.match(/[\/\\]([\w\d\s\.\-\(\)]+)$/)[1];
                } else {
                    fileLbl.innerHTML = "Choose a file";
                }
            });

        });


    </script>


    <script>

        $('.btn').click(function () {
            var isCreated = true;
            var table = document.getElementById('template-dtListing'), rIndex;
            for (var i = 0; i < table.rows.length; i++) {

                table.rows[i].onclick = function () {
                    rIndex = this.rowIndex;
                    var templateId = this.cells[0].innerHTML;
                    var templateName = this.cells[1].innerHTML;
                   
                    var editorContent = $('#summernote').summernote('code');
                    document.getElementById('documentCreate_EmailBody').value = editorContent;

                    var subject = $('#subject').val();
                    var sender = $('#from').val();
                    var recipient = $('#recipientEmail').val();
                    var xlsxFileAndPath = $('#fileAndPath').text();
                    var smsBody = $('#smsBody').val();
                    var smsRecipient = $('#smsRecipient').val();

                    var templateFolder = document.getElementById("selectedTemplateFolder");
                    var folderId = templateFolder.options[templateFolder.selectedIndex].value;
                    var selectedTemplateFolder = templateFolder.options[templateFolder.selectedIndex].text;

                    var casenum = document.getElementById("casenumMergeHeader");
                    var caseNumber = casenum.options[casenum.selectedIndex].text;



                    var data = { "templateID": templateId, "templateName": templateName, "templateFolderId": folderId, "excelFilePath": xlsxFileAndPath, "caseNumber": caseNumber, "selectedFolder": selectedTemplateFolder };




                    startUpdatingDocCreateProgressIndicator();
                    $('.btn').prop('disabled', true);
                    //document.getElementById('.btn').disabled = true;
                    $.ajax({
                        type: 'post',
                        contentType: 'application/json',
                        datatype: "json",
                        url: '@Url.Action("SignNowGenerateDocument", "MassMailer")',
                        data: JSON.stringify(data),
                        success: function (result) {


                          

                                stopUpdatingDocCreateProgressIndicator();

                            isCreated = true;

                        
                            document.getElementById('documentCreate_EmailSubject').value = subject;
                            document.getElementById('documentCreate_EmailSender').value = sender;
                            document.getElementById('documentCreate_EmailRecipient').value = recipient;

                            document.getElementById('documentCreate_SMSBody').value = smsBody;
                            document.getElementById('documentCreate_SMSRecipient').value = smsRecipient;

                            document.getElementById('documentCreate_TemplateFolderId').value = folderId;
                            document.getElementById('documentCreate_TemplateFolder').value = selectedTemplateFolder;
                            document.getElementById('documentCreate_FolderCasenumber').value = caseNumber;
                            var url = new URL(window.location.href);
                            url.searchParams.set(xlsxFileAndPath, editorContent, subject, sender, recipient, smsBody, smsRecipient, folderId, selectedTemplateFolder,caseNumber );
                            window.location.href = url.href;
                            location.reload(true);
                            //document.getElementById('.btn').disabled = false;
                            $('.btn').prop('disabled', false);

                        }

                    });
                }
            }
        });

        var intervalId;

        function startUpdatingDocCreateProgressIndicator() {
            $("#progress").show();

            intervalId = setInterval(
                function () {
                    // We use the POST requests here to avoid caching problems (we could use the GET requests and disable the cache instead)
                    $.post(
                         '@Url.Action("Progress", "MassMailer")',
                        function (progress) {

                            $("#progress").css({ width: progress + "%" });
                            $("#progress").html(progress + "%");
                        }
                    );
                },
                10
            );
        }

        function stopUpdatingDocCreateProgressIndicator() {
            clearInterval(intervalId);
        }



        $("#loadTemplates").click(function () {
            const  emptyEmailBody = "<p><br></p>";
            var emailBody = document.getElementById('@Html.IdFor(p => p.EmailBody)');

            if (emailBody.innerText != emptyEmailBody) {
                var editorContent = $('#summernote').summernote('code');
                document.getElementById('templateSelect_EmailBody').value = editorContent;
            }

            var templateFolder = document.getElementById("selectedTemplateFolder");
            var folderId = templateFolder.options[templateFolder.selectedIndex].value;
            var selectedTemplateFolder = templateFolder.options[templateFolder.selectedIndex].text;

            var casenum = document.getElementById("casenumMergeHeader");
            var caseNumber = casenum.options[casenum.selectedIndex].text;

            var subject = $('#subject').val();
            var sender = $('#from').val();
            var recipient = $('#recipientEmail').val();
            var xlsxFileAndPath = $('#fileAndPath').text();
            var smsBody = $('#smsBody').val();
            var smsRecipient = $('#smsRecipient').val();
            document.getElementById('templateSelect_EmailSubject').value = subject;
            document.getElementById('templateSelect_EmailFrom').value = sender;
            document.getElementById('templateSelect_EmailRecipient').value = recipient;
            document.getElementById('templateSelect_ExcelFile').value = xlsxFileAndPath;
            document.getElementById('templateSelect_TemplateFolder').value = selectedTemplateFolder;
            document.getElementById('templateSelect_TemplateFolderId').value = caseNumber;
            document.getElementById('templateSelect_SMS').value = smsBody;
            document.getElementById('templateSelect_RecipientSMS').value = smsRecipient;
            document.getElementById('templateSelect_TemplateFolderId').value = folderId;

        });

    </script>

  
    <script>
        $("#btnSendEmail").click(function () {
            var isEmailed = false;
            const  emptyEmailBody = "<p><br></p>";
            var emailBody = document.getElementById('@Html.IdFor(p => p.EmailBody)');

            if (emailBody.innerText != emptyEmailBody) {
                var editorContent = $('#summernote').summernote('code');
                document.getElementById('sendEmail_EmailBody').value = editorContent;
                var subject = $('#subject').val();
                var sender = $('#from').val();
                var recipient = $('#recipientEmail').val();
                var xlsxFileAndPath = $('#fileAndPath').text();
                var smsBody = $('#smsBody').val();
                var smsRecipient = $('#smsRecipient').val();



                var emailParameters = { "xslxFile": xlsxFileAndPath, "emailBody": emailBody.value , "emailSubject": subject, "emailSender": sender, "emailRecipientAddress": recipient, "txtMessage": smsBody, "txtRecipient": smsRecipient };
                document.getElementById('btnSendEmail').disabled = true;
                startUpdatingEmailProgressIndicator();

                 $.ajax({
                        type: 'post',
                        contentType: 'application/json',
                        url: '@Url.Action("SendEmail", "MassMailer")',
                     data: JSON.stringify(emailParameters),
                     success: function (result) {
                         stopUpdatingEmailProgressIndicator();
                         document.getElementById('btnSendEmail').disabled = false;
                         isEmailed=true
                        }

                    });
            }
        });
        var intervalId;

        function startUpdatingEmailProgressIndicator() {
            $("#emailProgress").show();

            intervalId = setInterval(
                function () {
                    // We use the POST requests here to avoid caching problems (we could use the GET requests and disable the cache instead)
                    $.post(
                         '@Url.Action("Progress", "MassMailer")',
                        function (progress) {

                            $("#emailProgress").css({ width: progress + "%" });
                            $("#emailProgress").html(progress + "%");
                        }
                    );
                },
                10
            );
        }

        function stopUpdatingEmailProgressIndicator() {
            clearInterval(intervalId);
        }

        $('.btn').click(function () {
            $("#zoomupModal").hide();
        });
    </script>

    <script>

        $('#btnSendSms').click(function () {

            var phoneNumbers = $('#smsRecipient').val();
            var smsBody = $('#smsBody').val();
            var xlsxFileAndPath = $('#fileAndPath').text();

            var data = { "smsBody": smsBody, "recipient": phoneNumbers, "excelFilePath": xlsxFileAndPath };
            startUpdatingSMSProgressIndicator();
            $.ajax({
                type: 'post',
                contentType: 'application/json',
                datatype: "json",
                url: '@Url.Action("SendSMS", "MassMailer")',
                data: JSON.stringify(data),
                success: function (result) {
                    stopUpdatingSMSProgressIndicator();
                }
            });

        });

        var intervalId;

        function startUpdatingSMSProgressIndicator() {
            $("#smsProgress").show();

            intervalId = setInterval(
                function () {
                    // We use the POST requests here to avoid caching problems (we could use the GET requests and disable the cache instead)
                    $.post(
                        '@Url.Action("Progress", "MassMailer")',
                        function (progress) {

                            $("#smsProgress").css({ width: progress + "%" });
                            $("#smsProgress").html(progress + "%");
                        }
                    );
                },
                10
            );
        }

        function stopUpdatingSMSProgressIndicator() {
            clearInterval(intervalId);
        }
    </script>

  


    <!-- END PAGE LEVEL SCRIPTS -->
    <!-- BEGIN PAGE LEVEL PLUGINS/CUSTOM SCRIPTS -->
</body>
</html>